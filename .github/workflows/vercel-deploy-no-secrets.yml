name: Vercel éƒ¨ç½² (æ— éœ€Secrets)

on:
  # æ‰‹åŠ¨è§¦å‘éƒ¨ç½²
  workflow_dispatch:
    inputs:
      environment:
        description: 'éƒ¨ç½²ç¯å¢ƒ'
        required: true
        default: 'production'
        type: choice
        options:
        - production
        - preview

  # é€šè¿‡commit messageè§¦å‘
  push:
    branches:
      - main
    paths:
      - 'api/**'
      - 'requirements.txt'
      - 'vercel.json'

jobs:
  trigger-vercel-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: è§¦å‘ Vercel éƒ¨ç½²
        run: |
          # ä½¿ç”¨Vercel Deploy Hookè§¦å‘éƒ¨ç½²
          # éœ€è¦åœ¨Vercelé¡¹ç›®è®¾ç½®ä¸­åˆ›å»ºDeploy Hook
          curl -X POST "${{ vars.VERCEL_DEPLOY_HOOK_URL }}" \
            -H "Authorization: Bearer ${{ vars.VERCEL_TOKEN }}" \
            -H "Content-Type: application/json" \
            -d '{"ref":"main","source":"github-actions"}'
        
      - name: ç­‰å¾…éƒ¨ç½²å®Œæˆ
        run: |
          echo "å·²è§¦å‘Verceléƒ¨ç½²..."
          echo "è¯·è®¿é—® Vercel Dashboard æŸ¥çœ‹éƒ¨ç½²çŠ¶æ€ï¼šhttps://vercel.com/dashboard"
          echo "é¡¹ç›®åç§°ï¼š${{ vars.VERCEL_PROJECT_NAME }}"

  notify-deployment:
    runs-on: ubuntu-latest
    needs: trigger-vercel-deploy
    steps:
      - name: é€šçŸ¥éƒ¨ç½²å®Œæˆ
        run: |
          echo "âœ… Vercel éƒ¨ç½²å·²è§¦å‘"
          echo "ğŸ“‹ è®¿é—®é“¾æ¥ï¼šhttps://${{ vars.VERCEL_PROJECT_NAME }}.vercel.app"
          echo "ğŸ”§ Vercel Dashboardï¼šhttps://vercel.com/dashboard"